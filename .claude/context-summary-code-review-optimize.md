## 项目上下文摘要(代码审查与优化)
生成时间: 2025-11-19

### 1. 任务目标
全面审查PSC-Graph项目代码，重点关注：
- 逻辑错误和维度不匹配问题
- 梯度失效或梯度连接失效问题
- 计算中可能出现的NaN问题
- 代码结构优化，减少回退机制，降低内存占用
- 文档补充和完善

### 2. 关键文件清单
**图学习核心文件**:
- `scripts/build_graph_pyg.py`: 图构建逻辑
- `scripts/train_hgt.py`: HGT模型训练
- `scripts/demo_graph_workflow.py`: 图学习演示流程

**其他关键文件**:
- `scripts/calibrate_and_conformal.py`: 校准和共形预测
- `scripts/build_index.py`: 索引构建
- `scripts/retrieve_evidence.py`: 检索逻辑

### 3. 常见风险点
**梯度问题**:
- 梯度消失/爆炸
- 梯度连接断裂
- 反向传播路径不完整

**维度问题**:
- 特征维度不匹配
- 批次维度处理错误
- 异质图节点特征对齐问题

**NaN问题**:
- 除零错误
- log(0)或log(负数)
- 数值溢出
- 梯度计算中的不稳定性

**内存问题**:
- 不必要的数据复制
- 大张量未及时释放
- 回退机制占用过多内存

### 4. 检查策略
1. 静态代码分析：检查逻辑错误和潜在bug
2. 维度追踪：验证张量维度在整个计算流程中的一致性
3. 梯度路径分析：确保所有参数都能接收梯度
4. 数值稳定性检查：添加必要的数值保护
5. 内存优化：识别并消除不必要的内存占用
